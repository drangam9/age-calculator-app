<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <!-- displays site properly based on user's device -->

  <link rel="icon" type="image/png" sizes="32x32" href="./assets/images/favicon-32x32.png">
  <link rel="stylesheet" href="./style.css">
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,700;1,400;1,800&display=swap"
    rel="stylesheet">
  <title>Frontend Mentor | Age calculator app</title>

</head>

<body>

  <main class="main__container">
    <div class="date_container">
      <div class="date_input">
        <p id="day_p">Day</p>
        <input type="text" name="day" id="day" placeholder="DD" maxlength="2"></input>
        <p style="color: red;"> </p>
      </div>
      <div class="date_input">
        <p id="month_p">Month</p>
        <input type="text" name="month" id="month" placeholder="MM" maxlength="2"></input>
        <p style="color: red;"> </p>
      </div>
      <div class="date_input">
        <p id="year_p">Year</p>
        <input type="text" name="year" id="year" placeholder="YYYY" maxlength="4"></input>
        <p style="color: red;"></p>
      </div>
    </div>
    <div class="btn__wrapper">
      <hr>
      <button class="btn" onclick="func()"><img src="./assets/images/icon-arrow.svg"></button>
    </div>
    <h1 class="main__date"><span class="violet" id="years">--</span> years</h1>
    <h1 class="main__date"><span class="violet" id="months">--</span> months</h1>
    <h1 class="main__date"><span class="violet" id="days">--</span> days</h1>
  </main>
  <script>
    function func() {
      const today = new Date();
      const present = {
        year: today.getFullYear(),
        month: today.getMonth() + 1,
        day: today.getDate()
      }
      const age = {
        year: 0,
        month: 0,
        day: 0,
      }
      const dayInput = document.getElementById("day");
      const monthInput = document.getElementById("month");
      const yearInput = document.getElementById("year");

      dayInput.style.border = "";
      dayInput.previousElementSibling.style.color = "";
      dayInput.nextElementSibling.innerHTML = "";

      monthInput.style.border = "";
      monthInput.previousElementSibling.style.color = "";
      monthInput.nextElementSibling.innerHTML = "";

      yearInput.style.border = "";
      yearInput.previousElementSibling.style.color = "";
      yearInput.nextElementSibling.innerHTML = "";


      const day = Number(dayInput["value"]);
      const month = Number(monthInput["value"]);
      const year = Number(yearInput["value"]);
      const inputDate = new Date(year, month - 1, day);
      const msDay = 24 * 60 * 60 * 1000;
      const msMonth = 30 * msDay;
      const msYear = 365 * msDay;
      const dateDiff = today - inputDate;

      age.year = Math.floor(dateDiff / msYear);
      age.month = Math.floor(dateDiff % msYear / msMonth);
      age.day = Math.floor(dateDiff % msYear % msMonth / msDay);

      globalThis.DateOk = true;
      let isOk = true;
      if (inputDate >= today) {
        error(dayInput, "Must be in the past");
        error(monthInput);
        error(yearInput);
      }
      if (month > 12 || isNaN(month) || month < 1)
        error(monthInput, "Must be a valid month");
      if (isNaN(day) || day < 1)
        error(dayInput, "Must be a valid day");
      if (isNaN(year) || year < 0)
        error(yearInput, "Must be a valid year");

      if (day == "")
        error(dayInput, "This field is required");
      if (month == "")
        error(monthInput, "This field is required");
      if (year == "")
        error(yearInput, "This field is required");

      if (month < 13) {
        if (month % 2 == 0) {
          if (month < 8) {
            if (day > 30)
              isOk = false;
          }
          else {
            if (day > 31)
              isOk = false;
          }
        }
        else {
          if (month < 8) {
            if (day > 31)
              isOk = false;
          }
          else {
            if (day > 30)
              isOk = false;
          }
        }
      }
      else
        error(monthInput, "Must be a valid month");
      if (!isOk)
        error(dayInput, "Must be a valid day");
      if (globalThis.DateOk) {
        animate(age);
      }
    }
    function error(object, message = "") {
      object.style.border = "1px solid red";
      object.previousElementSibling.style.color = "red";
      object.nextElementSibling.innerHTML = message;
      globalThis.DateOk = false;
    }
    function animate(age) {
      let yearCount = 0;
      let monthCount = 0;
      let dayCount = 0;
      time = 500;
      setInterval(() => {
        if (yearCount <= age.year)
          document.getElementById("years").innerHTML = `${yearCount++}`;
      }, time / age.year);

      setInterval(() => {
        setInterval(() => {
          if (monthCount <= age.month)
            document.getElementById("months").innerHTML = `${monthCount++}`;
        }, time / age.month);

      }, time + 100);

      setInterval(() => {
        setInterval(() => {
          if (dayCount <= age.day)
            document.getElementById("days").innerHTML = `${dayCount++}`;
        }, time / age.day);

      }, 2 * time + 200);
    }
  </script>
</body>

</html>